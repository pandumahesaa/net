<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>NetShort Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#000;color:#fff}
header{padding:12px;text-align:center;background:#111;font-weight:bold}
#list{padding:10px}
.item{padding:10px;border-bottom:1px solid #333}
.item button{width:100%;padding:10px;margin-top:5px;background:#e50914;border:none;color:#fff;font-size:16px;border-radius:5px}
#playerBox{display:none;position:fixed;inset:0;background:#000}
video{width:100%;height:100%;background:#000}
#close{position:absolute;top:10px;right:10px;z-index:10;background:rgba(0,0,0,.6);color:#fff;border:none;padding:8px 12px;font-size:16px}
</style>
</head>

<body>

<header>NetShort</header>
<div id="list">Loading...</div>

<div id="playerBox">
  <button id="close" onclick="closePlayer()">âœ•</button>
  <video id="video" controls autoplay playsinline></video>
</div>

<script>
const API_BASE =
  "https://cors.isomorphic-git.org/https://netshort.sansekai.my.id/api/netshort";

fetch(API_BASE + "/foryou")
.then(r => r.json())
.then(res => {
  const list = document.getElementById("list");
  list.innerHTML = "";
  const data = res.data || res;
  data.forEach(item => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div>${item.title || "Untitled"}</div>
      <button onclick="play('${item.id}')">Nonton</button>
    `;
    list.appendChild(div);
  });
})
.catch(() => {
  document.getElementById("list").innerText =
    "Gagal load data (proxy error)";
});

function play(id){
  fetch(API_BASE + "/theater/" + id)
  .then(r => r.json())
  .then(d => openPlayer(d.stream_url));
}

let hls;
function openPlayer(url){
  const box = document.getElementById("playerBox");
  const video = document.getElementById("video");
  box.style.display = "block";

  if(url.endsWith(".m3u8")){
    if(Hls.isSupported()){
      hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
    } else {
      video.src = url;
    }
  } else {
    video.src = url;
  }
  video.play();
}

function closePlayer(){
  const video = document.getElementById("video");
  video.pause();
  video.src = "";
  if(hls){ hls.destroy(); hls = null; }
  document.getElementById("playerBox").style.display = "none";
}
</script>

</body>
</html>
